<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Smart Delivery Insight - Postman Login</title>
  <?!= include('CSS') ?>
</head>
<body>
  <div class="login-container">
    <div class="smart-indicator"></div>
    
    <div class="postman-logo"></div>
    
    <h1 class="title">Smart Delivery Insight</h1>
    <div class="smart-badge">ü§ñ AI next 2  SYSTEM</div>
    <p class="subtitle">SDIP</p>
    
    <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache -->
    <div id="cacheStatus" style="
      display: none;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #2196f3;
      text-align: left;
      animation: slideDown 0.3s ease-out;
    ">
      <strong style="color: #1976d2;">üíæ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏¥‡∏°</strong><br>
      <span id="cachedUsername" style="color: #0d47a1; font-weight: 600;"></span>
      <span style="color: #666; font-size: 13px;">(‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Password ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠)</span>
    </div>
    
    <form id="loginForm">
      <div class="form-group">
        <label class="form-label" for="username">üë§ Username</label>
        <input 
          type="text" 
          id="username" 
          name="username" 
          class="form-input" 
          placeholder="‡∏õ‡πâ‡∏≠‡∏ô username ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
          required
          autocomplete="username"
        >
      </div>
      
      <div class="form-group">
        <label class="form-label" for="password">üîê Password</label>
        <input 
          type="password" 
          id="password" 
          name="password" 
          class="form-input" 
          placeholder="‡∏õ‡πâ‡∏≠‡∏ô password ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
          required
          autocomplete="current-password"
        >
      </div>
      
      <button type="submit" id="loginBtn" class="login-btn">
        üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞
      </button>
      
      <div id="loading" class="loading">
        <span class="loading-spinner"></span>
        <span class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
      </div>
      
      <div id="errorMessage" class="error-message"></div>
    </form>
    
    <div class="features">
      <div class="feature-item">
        <span class="feature-icon">‚ö°</span>
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡πá‡∏ß‡∏î‡πâ‡∏ß‡∏¢ AI Cache
      </div>
      <div class="feature-item">
        <span class="feature-icon">üîí</span>
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
      </div>
      <div class="feature-item">
        <span class="feature-icon">üìä</span>
        Dashboard ‡πÅ‡∏ö‡∏ö Real-time
      </div>
    </div>
  </div>

  <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Dashboard -->
  <div id="dashboardContainer" style="display: none;">
    <!-- Dashboard ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
  </div>

  <script>
    // =================================================================
    // üéØ SMART LOGIN SYSTEM WITH CACHE & AUTO-FILL
    // =================================================================
    
    const loginForm = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const loading = document.getElementById('loading');
    const errorMessage = document.getElementById('errorMessage');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const cacheStatus = document.getElementById('cacheStatus');
    const cachedUsername = document.getElementById('cachedUsername');
    const dashboardContainer = document.getElementById('dashboardContainer');
    const loginContainer = document.querySelector('.login-container');
    
    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Session
    let currentSession = {
      token: null,
      username: null,
      role: null,
      hasCache: false
    };
    
    // =================================================================
    // üìÇ SECTION 1: CACHE DETECTION & AUTO-FILL
    // =================================================================
    
    /**
     * 1.1 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
     */
    window.addEventListener('load', function() {
      console.log('üîç [INIT] ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö...');
      
      // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£ Auto-login ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Login ‡πÄ‡∏™‡∏°‡∏≠
      const savedUsername = localStorage.getItem('lastUsername');
      
      if (savedUsername) {
        // ‡∏°‡∏µ Username ‡πÄ‡∏î‡∏¥‡∏° - ‡πÅ‡∏Ñ‡πà Auto-fill ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Auto-login
        console.log('üíæ [CACHE] ‡∏û‡∏ö Username ‡πÄ‡∏î‡∏¥‡∏°:', savedUsername);
        restoreUsernameFromCache(savedUsername);
      } else {
        // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢
        console.log('‚ÑπÔ∏è [CACHE] ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° - ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô');
      }
      
      // ‡∏•‡πâ‡∏≤‡∏á Token ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
      localStorage.removeItem('authToken');
      localStorage.removeItem('userRole');
      localStorage.removeItem('loginTime');
    });
    
    /**
     * 1.2 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
     */
    function onCacheCheckSuccess(result) {
      console.log('‚úÖ [CACHE CHECK] Result:', result);
      showLoading(false);
      
      if (result.status === 'valid') {
        console.log('üéâ [AUTO LOGIN] Session ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥');
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Session
        currentSession.token = localStorage.getItem('authToken');
        currentSession.username = result.username;
        currentSession.role = result.role;
        currentSession.hasCache = true;
        
        // ‡πÅ‡∏™‡∏î‡∏á Dashboard ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        showSuccessAndLoadDashboard(result);
        
      } else {
        // Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
        console.log('‚è∞ [AUTO LOGIN] Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏:', result.reason);
        
        const savedUsername = localStorage.getItem('lastUsername');
        if (savedUsername) {
          restoreUsernameFromCache(savedUsername);
          showInfo('Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Password ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'warning');
        }
        
        // ‡∏•‡∏ö Token ‡πÄ‡∏Å‡πà‡∏≤
        clearAuthData();
      }
    }
    
    /**
     * 1.3 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
     */
    function onCacheCheckFailure(error) {
      console.error('‚ùå [CACHE CHECK] Error:', error);
      showLoading(false);
      
      const savedUsername = localStorage.getItem('lastUsername');
      if (savedUsername) {
        restoreUsernameFromCache(savedUsername);
      }
      
      clearAuthData();
    }
    
    /**
     * 1.4 ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô Username ‡∏à‡∏≤‡∏Å Cache ‡πÅ‡∏•‡∏∞ Auto-fill
     */
    function restoreUsernameFromCache(username) {
      console.log('üíæ [AUTO FILL] ‡∏Å‡∏≥‡∏•‡∏±‡∏á Auto-fill Username:', username);
      
      usernameInput.value = username;
      usernameInput.style.borderColor = '#2196f3';
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      cacheStatus.style.display = 'block';
      cachedUsername.textContent = username;
      
      // Focus ‡∏ó‡∏µ‡πà Password
      passwordInput.focus();
      
      currentSession.hasCache = true;
    }
    
    // =================================================================
    // üìÇ SECTION 2: REAL-TIME LOGIN VALIDATION
    // =================================================================
    
    /**
     * 2.1 ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå Username
     */
    usernameInput.addEventListener('input', function() {
      const username = this.value.trim();
      
      if (username.length > 0) {
        this.style.borderColor = '#ff4444';
        
        // ‡∏ã‡πà‡∏≠‡∏ô Cache Status ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Username
        const savedUsername = localStorage.getItem('lastUsername');
        if (savedUsername && username !== savedUsername) {
          cacheStatus.style.display = 'none';
        }
      } else {
        this.style.borderColor = '#ecf0f1';
      }
    });
    
    /**
     * 2.2 ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå Password
     */
    passwordInput.addEventListener('input', function() {
      const password = this.value;
      
      if (password.length > 0) {
        this.style.borderColor = '#ff4444';
        
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Username ‡πÅ‡∏•‡∏∞ Password ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° Login
        if (usernameInput.value.trim().length > 0) {
          loginBtn.disabled = false;
          loginBtn.style.opacity = '1';
        }
      } else {
        this.style.borderColor = '#ecf0f1';
      }
    });
    
    /**
     * 2.3 Auto-login ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Enter ‡∏ó‡∏µ‡πà Password
     */
    passwordInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        handleLogin();
      }
    });
    
    // =================================================================
    // üìÇ SECTION 3: LOGIN PROCESS
    // =================================================================
    
    /**
     * 3.1 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
     */
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      handleLogin();
    });
    
    /**
     * 3.2 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
     */
    function handleLogin() {
      const username = usernameInput.value.trim();
      const password = passwordInput.value;
      
      // Validation
      if (!username || !password) {
        showError('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username ‡πÅ‡∏•‡∏∞ Password ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        shakeForm();
        return;
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á Loading
      showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
      hideError();
      
      console.log('üîê [LOGIN] ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô:', username);
      
      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
      google.script.run
        .withSuccessHandler(onLoginSuccess)
        .withFailureHandler(onLoginFailure)
        .userLogin({
          username: username,
          password: password
        });
      
      // Timeout Protection
      setTimeout(() => {
        if (loginBtn.disabled) {
          showLoading(false);
          showError('‚è∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        }
      }, 20000);
    }
    
    /**
     * 3.3 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
     */
    function onLoginSuccess(result) {
      console.log('üìä [LOGIN] Result:', result);
      showLoading(false);
      
      if (result.status === 'success') {
        console.log('‚úÖ [LOGIN] ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à -', result.username, '(' + result.role + ')');
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Session
        localStorage.setItem('authToken', result.token);
        localStorage.setItem('lastUsername', result.username);
        localStorage.setItem('userRole', result.role);
        localStorage.setItem('loginTime', new Date().toISOString());
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Session
        currentSession.token = result.token;
        currentSession.username = result.username;
        currentSession.role = result.role;
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î Dashboard
        showSuccessAndLoadDashboard(result);
        
      } else {
        console.log('‚ùå [LOGIN] ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', result.message);
        showError('‚ùå ' + (result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ'));
        shakeForm();
      }
    }
    
    /**
     * 3.4 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
     */
    function onLoginFailure(error) {
      console.error('‚ùå [LOGIN ERROR]:', error);
      showLoading(false);
      showError('üîß ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
      shakeForm();
    }
    
    // =================================================================
    // üìÇ SECTION 4: DASHBOARD LOADING WITH ROLE-BASED ACCESS
    // =================================================================
    
    /**
     * 4.1 ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î Dashboard
     */
    function showSuccessAndLoadDashboard(userInfo) {
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      loginBtn.innerHTML = '‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
      loginBtn.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
      
      // Animation ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      successAnimation();
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      console.log('üìä [DASHBOARD] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Dashboard ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:', userInfo.username);
      console.log('üé≠ [DASHBOARD] Role:', userInfo.role);
      
      // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô Animation
      setTimeout(() => {
        loadDashboard(userInfo);
      }, 1000);
    }
    
    /**
     * 4.2 ‡πÇ‡∏´‡∏•‡∏î Dashboard ‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
     */
    function loadDashboard(userInfo) {
      console.log('üîÑ [DASHBOARD] ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î...');
      
      showLoading(true, '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡∏£‡∏∞‡∏ö‡∏ö SDIP...');
      
      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î Dashboard ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      google.script.run
        .withSuccessHandler((dashboardHtml) => {
          console.log('‚úÖ [DASHBOARD] ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          
          // ‡πÅ‡∏™‡∏î‡∏á Dashboard
          displayDashboard(dashboardHtml, userInfo);
        })
        .withFailureHandler((error) => {
          console.error('‚ùå [DASHBOARD ERROR]:', error);
          showLoading(false);
          showError('üìä ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Dashboard ‡πÑ‡∏î‡πâ: ' + error.message);
        })
        .getDashboardHtmlWithUserData(userInfo);
    }
    
    /**
     * 4.3 ‡πÅ‡∏™‡∏î‡∏á Dashboard ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login
     */
    function displayDashboard(html, userInfo) {
      console.log('üé® [DISPLAY] ‡πÅ‡∏™‡∏î‡∏á Dashboard...');
      
      // ‡πÅ‡∏ó‡∏£‡∏Å HTML ‡∏Ç‡∏≠‡∏á Dashboard
      dashboardContainer.innerHTML = html;
      
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏î‡πâ‡∏ß‡∏¢ Animation
      loginContainer.style.transition = 'all 0.5s ease-out';
      loginContainer.style.opacity = '0';
      loginContainer.style.transform = 'scale(0.95)';
      
      setTimeout(() => {
        loginContainer.style.display = 'none';
        
        // ‡πÅ‡∏™‡∏î‡∏á Dashboard ‡∏î‡πâ‡∏ß‡∏¢ Animation
        dashboardContainer.style.display = 'block';
        dashboardContainer.style.opacity = '0';
        dashboardContainer.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          dashboardContainer.style.transition = 'all 0.5s ease-out';
          dashboardContainer.style.opacity = '1';
          dashboardContainer.style.transform = 'translateY(0)';
        }, 50);
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Dashboard
        if (typeof initDashboard === 'function') {
          initDashboard(userInfo);
        }
        
        console.log('‚úÖ [DISPLAY] ‡πÅ‡∏™‡∏î‡∏á Dashboard ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }, 500);
    }
    
    // =================================================================
    // üìÇ SECTION 5: UI HELPER FUNCTIONS
    // =================================================================
    
    /**
     * 5.1 ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô Loading
     */
    function showLoading(show, message = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...') {
      if (show) {
        loginBtn.disabled = true;
        loginBtn.innerHTML = 'üîÑ ' + message;
        loading.style.display = 'block';
        loading.querySelector('.loading-text').textContent = message;
      } else {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞';
        loading.style.display = 'none';
      }
    }
    
    /**
     * 5.2 ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Error
     */
    function showError(message) {
      errorMessage.innerHTML = message;
      errorMessage.style.display = 'block';
      
      // Auto hide
      setTimeout(() => {
        hideError();
      }, 5000);
    }
    
    /**
     * 5.3 ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Error
     */
    function hideError() {
      errorMessage.style.display = 'none';
    }
    
    /**
     * 5.4 ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Info
     */
    function showInfo(message, type = 'info') {
      const colors = {
        info: { bg: '#e3f2fd', border: '#2196f3', text: '#1976d2' },
        warning: { bg: '#fff3e0', border: '#ff9800', text: '#e65100' },
        success: { bg: '#e8f5e9', border: '#4caf50', text: '#2e7d32' }
      };
      
      const color = colors[type] || colors.info;
      
      errorMessage.innerHTML = message;
      errorMessage.style.display = 'block';
      errorMessage.style.background = color.bg;
      errorMessage.style.borderColor = color.border;
      errorMessage.style.color = color.text;
    }
    
    /**
     * 5.5 Animation Shake
     */
    function shakeForm() {
      loginContainer.style.animation = 'shake 0.5s ease-in-out';
      setTimeout(() => {
        loginContainer.style.animation = '';
      }, 500);
    }
    
    /**
     * 5.6 Animation Success
     */
    function successAnimation() {
      loginContainer.style.transform = 'scale(1.05)';
      loginContainer.style.boxShadow = '0 25px 50px rgba(39,174,96,0.3)';
      
      setTimeout(() => {
        loginContainer.style.transform = 'scale(1)';
        loginContainer.style.boxShadow = '0 25px 50px rgba(0,0,0,0.25)';
      }, 300);
    }
    
    /**
     * 5.7 ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Auth
     */
    function clearAuthData() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('userRole');
      localStorage.removeItem('loginTime');
      // ‡πÄ‡∏Å‡πá‡∏ö lastUsername ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Auto-fill
    }
    
    // =================================================================
    // üìÇ SECTION 6: NETWORK STATUS
    // =================================================================
    
    window.addEventListener('online', function() {
      console.log('üåê [NETWORK] ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
      showInfo('üåê ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
    });
    
    window.addEventListener('offline', function() {
      console.log('üìµ [NETWORK] ‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
      showError('üìµ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
    });
    
    // =================================================================
    // üé® ANIMATION CSS
    // =================================================================
    
    const style = document.createElement('style');
    style.textContent = `
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
      }
      
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .error-message {
        animation: slideDown 0.3s ease-out;
      }
    `;
    document.head.appendChild(style);
    
    console.log('‚úÖ [INIT] ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
  </script>
</body>
</html>
